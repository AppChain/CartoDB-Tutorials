
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Example SQL - Earthquake topology</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="example">
  <meta name="author" content="Andrew W Hill / CartoDB">

  <link rel="stylesheet" type="text/css" href="http://twitter.github.com/bootstrap/1.4.0/bootstrap.min.css">
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.3.1/leaflet.css" />

  <link rel="stylesheet" href="http://vizzuality.github.com/cartodb-leaflet/css/cartodb-leaflet.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script src="http://cdn.leafletjs.com/leaflet-0.3.1/leaflet.js"></script>

  <script type="text/javascript" src="http://vizzuality.github.com/cartodb-leaflet/js/wax.leaf.min.js"></script>
  <script type="text/javascript" src="http://vizzuality.github.com/cartodb-leaflet/dist/cartodb-leaflet-min.js"></script>
  <script type="text/javascript" src="http://vizzuality.github.com/cartodb-leaflet/dist/cartodb-popup-min.js"></script>

  <style type='text/css'>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background: white;
    }
    #map{
      height: 100%;
      width: 100%;
      background: white;
    }
  </style>
  <script>
    var nyc_elevation;
    function initialize(){
      // starting latitude and longitude for our map
      var position = new L.LatLng(40.67, -113.98);
      
      // starting zoom
      var zoom = 3; 

      // is our Leaflet map object

      // is our Leaflet map object
      var raster_table = 'worldpaper';
      var map = new L.Map('map').setView(position, zoom)
        , rasterUrl = "http://viz2.cartodb.com/tiles/"+raster_table+"/{z}/{x}/{y}.png?sql=WITH rastpoly AS (SELECT st_dumpaspolygons(rast) valgeom FROM "+raster_table+" WHERE st_intersects(rast,cdb_xyz_extent({x},{y},{z}))) SELECT (valgeom).val as bandval, (valgeom).geom as the_geom_webmercator FROM rastpoly" //{z}+1 because mapnik gives better text interpolation than rasterizing in postgis does
        , basemap = new L.TileLayer(rasterUrl, {
            maxZoom: 20, 
            attribution: "CartoDB Tutorials"
          })
        , outline = 'http://viz2.cartodb.com/tiles/usa_admin/{z}/{x}/{y}.png?style=%23usa_admin%20%7B%20%20%20line-color%3A%23FFFFFF%3B%20%20%20line-width%3A1%3B%20%20%20line-opacity%3A1%3B%20%20%20polygon-opacity%3A0%3B%20%20%20polygon-fill%3Atransparent%3B%7D'
        //, mapboxUrl = 'http://tile.stamen.com/toner/{z}/{x}/{y}.jpg'
        , outlineMap = new L.TileLayer(outline, {
            maxZoom: 20, 
            attribution: ""
          });
      map.addLayer(basemap);
      map.addLayer(outlineMap);

    }
  </script>
</head>
  <body onload="initialize()">
    <div id="map"></div>
  </body>
</html>
